{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n    return _extendStatics(d, b);\n  };\n  return function (d, b) {\n    _extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport * as errors from '../../../base/common/errors.js';\nimport { EDITOR_MODEL_DEFAULTS } from '../config/editorOptions.js';\nimport { TextModel } from '../model/textModel.js';\nimport { DocumentSemanticTokensProviderRegistry, TokenMetadata } from '../modes.js';\nimport { PLAINTEXT_LANGUAGE_IDENTIFIER } from '../modes/modesRegistry.js';\nimport { ITextResourcePropertiesService } from './textResourceConfigurationService.js';\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\nimport { RunOnceScheduler } from '../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../base/common/cancellation.js';\nimport { SparseEncodedTokens, MultilineTokens2 } from '../model/tokensStore.js';\nimport { IThemeService } from '../../../platform/theme/common/themeService.js';\nimport { ILogService, LogLevel } from '../../../platform/log/common/log.js';\nfunction MODEL_ID(resource) {\n  return resource.toString();\n}\nvar ModelData = /** @class */function () {\n  function ModelData(model, onWillDispose, onDidChangeLanguage) {\n    this._modelEventListeners = new DisposableStore();\n    this.model = model;\n    this._languageSelection = null;\n    this._languageSelectionListener = null;\n    this._modelEventListeners.add(model.onWillDispose(function () {\n      return onWillDispose(model);\n    }));\n    this._modelEventListeners.add(model.onDidChangeLanguage(function (e) {\n      return onDidChangeLanguage(model, e);\n    }));\n  }\n  ModelData.prototype._disposeLanguageSelection = function () {\n    if (this._languageSelectionListener) {\n      this._languageSelectionListener.dispose();\n      this._languageSelectionListener = null;\n    }\n    if (this._languageSelection) {\n      this._languageSelection.dispose();\n      this._languageSelection = null;\n    }\n  };\n  ModelData.prototype.dispose = function () {\n    this._modelEventListeners.dispose();\n    this._disposeLanguageSelection();\n  };\n  ModelData.prototype.setLanguage = function (languageSelection) {\n    var _this = this;\n    this._disposeLanguageSelection();\n    this._languageSelection = languageSelection;\n    this._languageSelectionListener = this._languageSelection.onDidChange(function () {\n      return _this.model.setMode(languageSelection.languageIdentifier);\n    });\n    this.model.setMode(languageSelection.languageIdentifier);\n  };\n  return ModelData;\n}();\nvar DEFAULT_EOL = platform.isLinux || platform.isMacintosh ? 1 /* LF */ : 2 /* CRLF */;\nvar ModelServiceImpl = /** @class */function (_super) {\n  __extends(ModelServiceImpl, _super);\n  function ModelServiceImpl(configurationService, resourcePropertiesService, themeService, logService) {\n    var _this = _super.call(this) || this;\n    _this._onModelAdded = _this._register(new Emitter());\n    _this.onModelAdded = _this._onModelAdded.event;\n    _this._onModelRemoved = _this._register(new Emitter());\n    _this.onModelRemoved = _this._onModelRemoved.event;\n    _this._onModelModeChanged = _this._register(new Emitter());\n    _this.onModelModeChanged = _this._onModelModeChanged.event;\n    _this._configurationService = configurationService;\n    _this._resourcePropertiesService = resourcePropertiesService;\n    _this._models = {};\n    _this._modelCreationOptionsByLanguageAndResource = Object.create(null);\n    _this._configurationServiceSubscription = _this._configurationService.onDidChangeConfiguration(function (e) {\n      return _this._updateModelOptions();\n    });\n    _this._updateModelOptions();\n    _this._register(new SemanticColoringFeature(_this, themeService, configurationService, logService));\n    return _this;\n  }\n  ModelServiceImpl._readModelOptions = function (config, isForSimpleWidget) {\n    var tabSize = EDITOR_MODEL_DEFAULTS.tabSize;\n    if (config.editor && typeof config.editor.tabSize !== 'undefined') {\n      var parsedTabSize = parseInt(config.editor.tabSize, 10);\n      if (!isNaN(parsedTabSize)) {\n        tabSize = parsedTabSize;\n      }\n      if (tabSize < 1) {\n        tabSize = 1;\n      }\n    }\n    var indentSize = tabSize;\n    if (config.editor && typeof config.editor.indentSize !== 'undefined' && config.editor.indentSize !== 'tabSize') {\n      var parsedIndentSize = parseInt(config.editor.indentSize, 10);\n      if (!isNaN(parsedIndentSize)) {\n        indentSize = parsedIndentSize;\n      }\n      if (indentSize < 1) {\n        indentSize = 1;\n      }\n    }\n    var insertSpaces = EDITOR_MODEL_DEFAULTS.insertSpaces;\n    if (config.editor && typeof config.editor.insertSpaces !== 'undefined') {\n      insertSpaces = config.editor.insertSpaces === 'false' ? false : Boolean(config.editor.insertSpaces);\n    }\n    var newDefaultEOL = DEFAULT_EOL;\n    var eol = config.eol;\n    if (eol === '\\r\\n') {\n      newDefaultEOL = 2 /* CRLF */;\n    } else if (eol === '\\n') {\n      newDefaultEOL = 1 /* LF */;\n    }\n\n    var trimAutoWhitespace = EDITOR_MODEL_DEFAULTS.trimAutoWhitespace;\n    if (config.editor && typeof config.editor.trimAutoWhitespace !== 'undefined') {\n      trimAutoWhitespace = config.editor.trimAutoWhitespace === 'false' ? false : Boolean(config.editor.trimAutoWhitespace);\n    }\n    var detectIndentation = EDITOR_MODEL_DEFAULTS.detectIndentation;\n    if (config.editor && typeof config.editor.detectIndentation !== 'undefined') {\n      detectIndentation = config.editor.detectIndentation === 'false' ? false : Boolean(config.editor.detectIndentation);\n    }\n    var largeFileOptimizations = EDITOR_MODEL_DEFAULTS.largeFileOptimizations;\n    if (config.editor && typeof config.editor.largeFileOptimizations !== 'undefined') {\n      largeFileOptimizations = config.editor.largeFileOptimizations === 'false' ? false : Boolean(config.editor.largeFileOptimizations);\n    }\n    return {\n      isForSimpleWidget: isForSimpleWidget,\n      tabSize: tabSize,\n      indentSize: indentSize,\n      insertSpaces: insertSpaces,\n      detectIndentation: detectIndentation,\n      defaultEOL: newDefaultEOL,\n      trimAutoWhitespace: trimAutoWhitespace,\n      largeFileOptimizations: largeFileOptimizations\n    };\n  };\n  ModelServiceImpl.prototype.getCreationOptions = function (language, resource, isForSimpleWidget) {\n    var creationOptions = this._modelCreationOptionsByLanguageAndResource[language + resource];\n    if (!creationOptions) {\n      var editor = this._configurationService.getValue('editor', {\n        overrideIdentifier: language,\n        resource: resource\n      });\n      var eol = this._resourcePropertiesService.getEOL(resource, language);\n      creationOptions = ModelServiceImpl._readModelOptions({\n        editor: editor,\n        eol: eol\n      }, isForSimpleWidget);\n      this._modelCreationOptionsByLanguageAndResource[language + resource] = creationOptions;\n    }\n    return creationOptions;\n  };\n  ModelServiceImpl.prototype._updateModelOptions = function () {\n    var oldOptionsByLanguageAndResource = this._modelCreationOptionsByLanguageAndResource;\n    this._modelCreationOptionsByLanguageAndResource = Object.create(null);\n    // Update options on all models\n    var keys = Object.keys(this._models);\n    for (var i = 0, len = keys.length; i < len; i++) {\n      var modelId = keys[i];\n      var modelData = this._models[modelId];\n      var language = modelData.model.getLanguageIdentifier().language;\n      var uri = modelData.model.uri;\n      var oldOptions = oldOptionsByLanguageAndResource[language + uri];\n      var newOptions = this.getCreationOptions(language, uri, modelData.model.isForSimpleWidget);\n      ModelServiceImpl._setModelOptionsForModel(modelData.model, newOptions, oldOptions);\n    }\n  };\n  ModelServiceImpl._setModelOptionsForModel = function (model, newOptions, currentOptions) {\n    if (currentOptions && currentOptions.defaultEOL !== newOptions.defaultEOL && model.getLineCount() === 1) {\n      model.setEOL(newOptions.defaultEOL === 1 /* LF */ ? 0 /* LF */ : 1 /* CRLF */);\n    }\n\n    if (currentOptions && currentOptions.detectIndentation === newOptions.detectIndentation && currentOptions.insertSpaces === newOptions.insertSpaces && currentOptions.tabSize === newOptions.tabSize && currentOptions.indentSize === newOptions.indentSize && currentOptions.trimAutoWhitespace === newOptions.trimAutoWhitespace) {\n      // Same indent opts, no need to touch the model\n      return;\n    }\n    if (newOptions.detectIndentation) {\n      model.detectIndentation(newOptions.insertSpaces, newOptions.tabSize);\n      model.updateOptions({\n        trimAutoWhitespace: newOptions.trimAutoWhitespace\n      });\n    } else {\n      model.updateOptions({\n        insertSpaces: newOptions.insertSpaces,\n        tabSize: newOptions.tabSize,\n        indentSize: newOptions.indentSize,\n        trimAutoWhitespace: newOptions.trimAutoWhitespace\n      });\n    }\n  };\n  ModelServiceImpl.prototype.dispose = function () {\n    this._configurationServiceSubscription.dispose();\n    _super.prototype.dispose.call(this);\n  };\n  // --- begin IModelService\n  ModelServiceImpl.prototype._createModelData = function (value, languageIdentifier, resource, isForSimpleWidget) {\n    var _this = this;\n    // create & save the model\n    var options = this.getCreationOptions(languageIdentifier.language, resource, isForSimpleWidget);\n    var model = new TextModel(value, options, languageIdentifier, resource);\n    var modelId = MODEL_ID(model.uri);\n    if (this._models[modelId]) {\n      // There already exists a model with this id => this is a programmer error\n      throw new Error('ModelService: Cannot add model because it already exists!');\n    }\n    var modelData = new ModelData(model, function (model) {\n      return _this._onWillDispose(model);\n    }, function (model, e) {\n      return _this._onDidChangeLanguage(model, e);\n    });\n    this._models[modelId] = modelData;\n    return modelData;\n  };\n  ModelServiceImpl.prototype.createModel = function (value, languageSelection, resource, isForSimpleWidget) {\n    if (isForSimpleWidget === void 0) {\n      isForSimpleWidget = false;\n    }\n    var modelData;\n    if (languageSelection) {\n      modelData = this._createModelData(value, languageSelection.languageIdentifier, resource, isForSimpleWidget);\n      this.setMode(modelData.model, languageSelection);\n    } else {\n      modelData = this._createModelData(value, PLAINTEXT_LANGUAGE_IDENTIFIER, resource, isForSimpleWidget);\n    }\n    this._onModelAdded.fire(modelData.model);\n    return modelData.model;\n  };\n  ModelServiceImpl.prototype.setMode = function (model, languageSelection) {\n    if (!languageSelection) {\n      return;\n    }\n    var modelData = this._models[MODEL_ID(model.uri)];\n    if (!modelData) {\n      return;\n    }\n    modelData.setLanguage(languageSelection);\n  };\n  ModelServiceImpl.prototype.getModels = function () {\n    var ret = [];\n    var keys = Object.keys(this._models);\n    for (var i = 0, len = keys.length; i < len; i++) {\n      var modelId = keys[i];\n      ret.push(this._models[modelId].model);\n    }\n    return ret;\n  };\n  ModelServiceImpl.prototype.getModel = function (resource) {\n    var modelId = MODEL_ID(resource);\n    var modelData = this._models[modelId];\n    if (!modelData) {\n      return null;\n    }\n    return modelData.model;\n  };\n  // --- end IModelService\n  ModelServiceImpl.prototype._onWillDispose = function (model) {\n    var modelId = MODEL_ID(model.uri);\n    var modelData = this._models[modelId];\n    delete this._models[modelId];\n    modelData.dispose();\n    // clean up cache\n    delete this._modelCreationOptionsByLanguageAndResource[model.getLanguageIdentifier().language + model.uri];\n    this._onModelRemoved.fire(model);\n  };\n  ModelServiceImpl.prototype._onDidChangeLanguage = function (model, e) {\n    var oldModeId = e.oldLanguage;\n    var newModeId = model.getLanguageIdentifier().language;\n    var oldOptions = this.getCreationOptions(oldModeId, model.uri, model.isForSimpleWidget);\n    var newOptions = this.getCreationOptions(newModeId, model.uri, model.isForSimpleWidget);\n    ModelServiceImpl._setModelOptionsForModel(model, newOptions, oldOptions);\n    this._onModelModeChanged.fire({\n      model: model,\n      oldModeId: oldModeId\n    });\n  };\n  ModelServiceImpl = __decorate([__param(0, IConfigurationService), __param(1, ITextResourcePropertiesService), __param(2, IThemeService), __param(3, ILogService)], ModelServiceImpl);\n  return ModelServiceImpl;\n}(Disposable);\nexport { ModelServiceImpl };\nvar SemanticColoringFeature = /** @class */function (_super) {\n  __extends(SemanticColoringFeature, _super);\n  function SemanticColoringFeature(modelService, themeService, configurationService, logService) {\n    var _this = _super.call(this) || this;\n    _this._configurationService = configurationService;\n    _this._watchers = Object.create(null);\n    _this._semanticStyling = _this._register(new SemanticStyling(themeService, logService));\n    var isSemanticColoringEnabled = function isSemanticColoringEnabled(model) {\n      var options = configurationService.getValue(SemanticColoringFeature.SETTING_ID, {\n        overrideIdentifier: model.getLanguageIdentifier().language,\n        resource: model.uri\n      });\n      return options && options.enabled;\n    };\n    var register = function register(model) {\n      _this._watchers[model.uri.toString()] = new ModelSemanticColoring(model, themeService, _this._semanticStyling);\n    };\n    var deregister = function deregister(model, modelSemanticColoring) {\n      modelSemanticColoring.dispose();\n      delete _this._watchers[model.uri.toString()];\n    };\n    _this._register(modelService.onModelAdded(function (model) {\n      if (isSemanticColoringEnabled(model)) {\n        register(model);\n      }\n    }));\n    _this._register(modelService.onModelRemoved(function (model) {\n      var curr = _this._watchers[model.uri.toString()];\n      if (curr) {\n        deregister(model, curr);\n      }\n    }));\n    _this._configurationService.onDidChangeConfiguration(function (e) {\n      if (e.affectsConfiguration(SemanticColoringFeature.SETTING_ID)) {\n        for (var _i = 0, _a = modelService.getModels(); _i < _a.length; _i++) {\n          var model = _a[_i];\n          var curr = _this._watchers[model.uri.toString()];\n          if (isSemanticColoringEnabled(model)) {\n            if (!curr) {\n              register(model);\n            }\n          } else {\n            if (curr) {\n              deregister(model, curr);\n            }\n          }\n        }\n      }\n    });\n    return _this;\n  }\n  SemanticColoringFeature.SETTING_ID = 'editor.semanticHighlighting';\n  return SemanticColoringFeature;\n}(Disposable);\nvar SemanticStyling = /** @class */function (_super) {\n  __extends(SemanticStyling, _super);\n  function SemanticStyling(_themeService, _logService) {\n    var _this = _super.call(this) || this;\n    _this._themeService = _themeService;\n    _this._logService = _logService;\n    _this._caches = new WeakMap();\n    if (_this._themeService) {\n      // workaround for tests which use undefined... :/\n      _this._register(_this._themeService.onThemeChange(function () {\n        _this._caches = new WeakMap();\n      }));\n    }\n    return _this;\n  }\n  SemanticStyling.prototype.get = function (provider) {\n    if (!this._caches.has(provider)) {\n      this._caches.set(provider, new SemanticColoringProviderStyling(provider.getLegend(), this._themeService, this._logService));\n    }\n    return this._caches.get(provider);\n  };\n  return SemanticStyling;\n}(Disposable);\nvar HashTableEntry = /** @class */function () {\n  function HashTableEntry(tokenTypeIndex, tokenModifierSet, metadata) {\n    this.tokenTypeIndex = tokenTypeIndex;\n    this.tokenModifierSet = tokenModifierSet;\n    this.metadata = metadata;\n    this.next = null;\n  }\n  return HashTableEntry;\n}();\nvar HashTable = /** @class */function () {\n  function HashTable() {\n    this._elementsCount = 0;\n    this._currentLengthIndex = 0;\n    this._currentLength = HashTable._SIZES[this._currentLengthIndex];\n    this._growCount = Math.round(this._currentLengthIndex + 1 < HashTable._SIZES.length ? 2 / 3 * this._currentLength : 0);\n    this._elements = [];\n    HashTable._nullOutEntries(this._elements, this._currentLength);\n  }\n  HashTable._nullOutEntries = function (entries, length) {\n    for (var i = 0; i < length; i++) {\n      entries[i] = null;\n    }\n  };\n  HashTable.prototype._hashFunc = function (tokenTypeIndex, tokenModifierSet) {\n    return ((tokenTypeIndex << 5) - tokenTypeIndex + tokenModifierSet | 0) % this._currentLength; // tokenTypeIndex * 31 + tokenModifierSet, keep as int32\n  };\n\n  HashTable.prototype.get = function (tokenTypeIndex, tokenModifierSet) {\n    var hash = this._hashFunc(tokenTypeIndex, tokenModifierSet);\n    var p = this._elements[hash];\n    while (p) {\n      if (p.tokenTypeIndex === tokenTypeIndex && p.tokenModifierSet === tokenModifierSet) {\n        return p;\n      }\n      p = p.next;\n    }\n    return null;\n  };\n  HashTable.prototype.add = function (tokenTypeIndex, tokenModifierSet, metadata) {\n    this._elementsCount++;\n    if (this._growCount !== 0 && this._elementsCount >= this._growCount) {\n      // expand!\n      var oldElements = this._elements;\n      this._currentLengthIndex++;\n      this._currentLength = HashTable._SIZES[this._currentLengthIndex];\n      this._growCount = Math.round(this._currentLengthIndex + 1 < HashTable._SIZES.length ? 2 / 3 * this._currentLength : 0);\n      this._elements = [];\n      HashTable._nullOutEntries(this._elements, this._currentLength);\n      for (var _i = 0, oldElements_1 = oldElements; _i < oldElements_1.length; _i++) {\n        var first = oldElements_1[_i];\n        var p = first;\n        while (p) {\n          var oldNext = p.next;\n          p.next = null;\n          this._add(p);\n          p = oldNext;\n        }\n      }\n    }\n    this._add(new HashTableEntry(tokenTypeIndex, tokenModifierSet, metadata));\n  };\n  HashTable.prototype._add = function (element) {\n    var hash = this._hashFunc(element.tokenTypeIndex, element.tokenModifierSet);\n    element.next = this._elements[hash];\n    this._elements[hash] = element;\n  };\n  HashTable._SIZES = [3, 7, 13, 31, 61, 127, 251, 509, 1021, 2039, 4093, 8191, 16381, 32749, 65521, 131071, 262139, 524287, 1048573, 2097143];\n  return HashTable;\n}();\nvar SemanticColoringProviderStyling = /** @class */function () {\n  function SemanticColoringProviderStyling(_legend, _themeService, _logService) {\n    this._legend = _legend;\n    this._themeService = _themeService;\n    this._logService = _logService;\n    this._hashTable = new HashTable();\n  }\n  SemanticColoringProviderStyling.prototype.getMetadata = function (tokenTypeIndex, tokenModifierSet) {\n    var entry = this._hashTable.get(tokenTypeIndex, tokenModifierSet);\n    var metadata;\n    if (entry) {\n      metadata = entry.metadata;\n    } else {\n      var tokenType = this._legend.tokenTypes[tokenTypeIndex];\n      var tokenModifiers = [];\n      var modifierSet = tokenModifierSet;\n      for (var modifierIndex = 0; modifierSet > 0 && modifierIndex < this._legend.tokenModifiers.length; modifierIndex++) {\n        if (modifierSet & 1) {\n          tokenModifiers.push(this._legend.tokenModifiers[modifierIndex]);\n        }\n        modifierSet = modifierSet >> 1;\n      }\n      var tokenStyle = this._themeService.getTheme().getTokenStyleMetadata(tokenType, tokenModifiers);\n      if (typeof tokenStyle === 'undefined') {\n        metadata = 2147483647 /* NO_STYLING */;\n      } else {\n        metadata = 0;\n        if (typeof tokenStyle.italic !== 'undefined') {\n          var italicBit = (tokenStyle.italic ? 1 /* Italic */ : 0) << 11 /* FONT_STYLE_OFFSET */;\n          metadata |= italicBit | 1 /* SEMANTIC_USE_ITALIC */;\n        }\n\n        if (typeof tokenStyle.bold !== 'undefined') {\n          var boldBit = (tokenStyle.bold ? 2 /* Bold */ : 0) << 11 /* FONT_STYLE_OFFSET */;\n          metadata |= boldBit | 2 /* SEMANTIC_USE_BOLD */;\n        }\n\n        if (typeof tokenStyle.underline !== 'undefined') {\n          var underlineBit = (tokenStyle.underline ? 4 /* Underline */ : 0) << 11 /* FONT_STYLE_OFFSET */;\n          metadata |= underlineBit | 4 /* SEMANTIC_USE_UNDERLINE */;\n        }\n\n        if (tokenStyle.foreground) {\n          var foregroundBits = tokenStyle.foreground << 14 /* FOREGROUND_OFFSET */;\n          metadata |= foregroundBits | 8 /* SEMANTIC_USE_FOREGROUND */;\n        }\n\n        if (metadata === 0) {\n          // Nothing!\n          metadata = 2147483647 /* NO_STYLING */;\n        }\n      }\n\n      this._hashTable.add(tokenTypeIndex, tokenModifierSet, metadata);\n    }\n    if (this._logService.getLevel() === LogLevel.Trace) {\n      var type = this._legend.tokenTypes[tokenTypeIndex];\n      var modifiers = tokenModifierSet ? ' ' + this._legend.tokenModifiers.filter(function (_, i) {\n        return tokenModifierSet & 1 << i;\n      }).join(' ') : '';\n      this._logService.trace(\"tokenStyleMetadata \" + (entry ? '[CACHED] ' : '') + type + modifiers + \": foreground \" + TokenMetadata.getForeground(metadata) + \", fontStyle \" + TokenMetadata.getFontStyle(metadata).toString(2));\n    }\n    return metadata;\n  };\n  return SemanticColoringProviderStyling;\n}();\nvar SemanticTokensResponse = /** @class */function () {\n  function SemanticTokensResponse(_provider, resultId, data) {\n    this._provider = _provider;\n    this.resultId = resultId;\n    this.data = data;\n  }\n  SemanticTokensResponse.prototype.dispose = function () {\n    this._provider.releaseDocumentSemanticTokens(this.resultId);\n  };\n  return SemanticTokensResponse;\n}();\nvar ModelSemanticColoring = /** @class */function (_super) {\n  __extends(ModelSemanticColoring, _super);\n  function ModelSemanticColoring(model, themeService, stylingProvider) {\n    var _this = _super.call(this) || this;\n    _this._isDisposed = false;\n    _this._model = model;\n    _this._semanticStyling = stylingProvider;\n    _this._fetchSemanticTokens = _this._register(new RunOnceScheduler(function () {\n      return _this._fetchSemanticTokensNow();\n    }, 300));\n    _this._currentResponse = null;\n    _this._currentRequestCancellationTokenSource = null;\n    _this._register(_this._model.onDidChangeContent(function (e) {\n      if (!_this._fetchSemanticTokens.isScheduled()) {\n        _this._fetchSemanticTokens.schedule();\n      }\n    }));\n    _this._register(DocumentSemanticTokensProviderRegistry.onDidChange(function (e) {\n      return _this._fetchSemanticTokens.schedule();\n    }));\n    if (themeService) {\n      // workaround for tests which use undefined... :/\n      _this._register(themeService.onThemeChange(function (_) {\n        // clear out existing tokens\n        _this._setSemanticTokens(null, null, null, []);\n        _this._fetchSemanticTokens.schedule();\n      }));\n    }\n    _this._fetchSemanticTokens.schedule(0);\n    return _this;\n  }\n  ModelSemanticColoring.prototype.dispose = function () {\n    if (this._currentResponse) {\n      this._currentResponse.dispose();\n      this._currentResponse = null;\n    }\n    if (this._currentRequestCancellationTokenSource) {\n      this._currentRequestCancellationTokenSource.cancel();\n      this._currentRequestCancellationTokenSource = null;\n    }\n    this._setSemanticTokens(null, null, null, []);\n    this._isDisposed = true;\n    _super.prototype.dispose.call(this);\n  };\n  ModelSemanticColoring.prototype._fetchSemanticTokensNow = function () {\n    var _this = this;\n    if (this._currentRequestCancellationTokenSource) {\n      // there is already a request running, let it finish...\n      return;\n    }\n    var provider = this._getSemanticColoringProvider();\n    if (!provider) {\n      return;\n    }\n    this._currentRequestCancellationTokenSource = new CancellationTokenSource();\n    var pendingChanges = [];\n    var contentChangeListener = this._model.onDidChangeContent(function (e) {\n      pendingChanges.push(e);\n    });\n    var styling = this._semanticStyling.get(provider);\n    var lastResultId = this._currentResponse ? this._currentResponse.resultId || null : null;\n    var request = Promise.resolve(provider.provideDocumentSemanticTokens(this._model, lastResultId, this._currentRequestCancellationTokenSource.token));\n    request.then(function (res) {\n      _this._currentRequestCancellationTokenSource = null;\n      contentChangeListener.dispose();\n      _this._setSemanticTokens(provider, res || null, styling, pendingChanges);\n    }, function (err) {\n      if (!err || typeof err.message !== 'string' || err.message.indexOf('busy') === -1) {\n        errors.onUnexpectedError(err);\n      }\n      // Semantic tokens eats up all errors and considers errors to mean that the result is temporarily not available\n      // The API does not have a special error kind to express this...\n      _this._currentRequestCancellationTokenSource = null;\n      contentChangeListener.dispose();\n      if (pendingChanges.length > 0) {\n        // More changes occurred while the request was running\n        if (!_this._fetchSemanticTokens.isScheduled()) {\n          _this._fetchSemanticTokens.schedule();\n        }\n      }\n    });\n  };\n  ModelSemanticColoring._isSemanticTokens = function (v) {\n    return v && !!v.data;\n  };\n  ModelSemanticColoring._isSemanticTokensEdits = function (v) {\n    return v && Array.isArray(v.edits);\n  };\n  ModelSemanticColoring._copy = function (src, srcOffset, dest, destOffset, length) {\n    for (var i = 0; i < length; i++) {\n      dest[destOffset + i] = src[srcOffset + i];\n    }\n  };\n  ModelSemanticColoring.prototype._setSemanticTokens = function (provider, tokens, styling, pendingChanges) {\n    var currentResponse = this._currentResponse;\n    if (this._currentResponse) {\n      this._currentResponse.dispose();\n      this._currentResponse = null;\n    }\n    if (this._isDisposed) {\n      // disposed!\n      if (provider && tokens) {\n        provider.releaseDocumentSemanticTokens(tokens.resultId);\n      }\n      return;\n    }\n    if (!provider || !tokens || !styling) {\n      this._model.setSemanticTokens(null);\n      return;\n    }\n    if (ModelSemanticColoring._isSemanticTokensEdits(tokens)) {\n      if (!currentResponse) {\n        // not possible!\n        this._model.setSemanticTokens(null);\n        return;\n      }\n      if (tokens.edits.length === 0) {\n        // nothing to do!\n        tokens = {\n          resultId: tokens.resultId,\n          data: currentResponse.data\n        };\n      } else {\n        var deltaLength = 0;\n        for (var _i = 0, _a = tokens.edits; _i < _a.length; _i++) {\n          var edit = _a[_i];\n          deltaLength += (edit.data ? edit.data.length : 0) - edit.deleteCount;\n        }\n        var srcData = currentResponse.data;\n        var destData = new Uint32Array(srcData.length + deltaLength);\n        var srcLastStart = srcData.length;\n        var destLastStart = destData.length;\n        for (var i = tokens.edits.length - 1; i >= 0; i--) {\n          var edit = tokens.edits[i];\n          var copyCount = srcLastStart - (edit.start + edit.deleteCount);\n          if (copyCount > 0) {\n            ModelSemanticColoring._copy(srcData, srcLastStart - copyCount, destData, destLastStart - copyCount, copyCount);\n            destLastStart -= copyCount;\n          }\n          if (edit.data) {\n            ModelSemanticColoring._copy(edit.data, 0, destData, destLastStart - edit.data.length, edit.data.length);\n            destLastStart -= edit.data.length;\n          }\n          srcLastStart = edit.start;\n        }\n        if (srcLastStart > 0) {\n          ModelSemanticColoring._copy(srcData, 0, destData, 0, srcLastStart);\n        }\n        tokens = {\n          resultId: tokens.resultId,\n          data: destData\n        };\n      }\n    }\n    if (ModelSemanticColoring._isSemanticTokens(tokens)) {\n      this._currentResponse = new SemanticTokensResponse(provider, tokens.resultId, tokens.data);\n      var srcData = tokens.data;\n      var tokenCount = tokens.data.length / 5 | 0;\n      var tokensPerArea = Math.max(Math.ceil(tokenCount / 1024 /* DesiredMaxAreas */), 400 /* DesiredTokensPerArea */);\n      var result = [];\n      var tokenIndex = 0;\n      var lastLineNumber = 1;\n      var lastStartCharacter = 0;\n      while (tokenIndex < tokenCount) {\n        var tokenStartIndex = tokenIndex;\n        var tokenEndIndex = Math.min(tokenStartIndex + tokensPerArea, tokenCount);\n        // Keep tokens on the same line in the same area...\n        if (tokenEndIndex < tokenCount) {\n          var smallTokenEndIndex = tokenEndIndex;\n          while (smallTokenEndIndex - 1 > tokenStartIndex && srcData[5 * smallTokenEndIndex] === 0) {\n            smallTokenEndIndex--;\n          }\n          if (smallTokenEndIndex - 1 === tokenStartIndex) {\n            // there are so many tokens on this line that our area would be empty, we must now go right\n            var bigTokenEndIndex = tokenEndIndex;\n            while (bigTokenEndIndex + 1 < tokenCount && srcData[5 * bigTokenEndIndex] === 0) {\n              bigTokenEndIndex++;\n            }\n            tokenEndIndex = bigTokenEndIndex;\n          } else {\n            tokenEndIndex = smallTokenEndIndex;\n          }\n        }\n        var destData = new Uint32Array((tokenEndIndex - tokenStartIndex) * 4);\n        var destOffset = 0;\n        var areaLine = 0;\n        while (tokenIndex < tokenEndIndex) {\n          var srcOffset = 5 * tokenIndex;\n          var deltaLine = srcData[srcOffset];\n          var deltaCharacter = srcData[srcOffset + 1];\n          var lineNumber = lastLineNumber + deltaLine;\n          var startCharacter = deltaLine === 0 ? lastStartCharacter + deltaCharacter : deltaCharacter;\n          var length_1 = srcData[srcOffset + 2];\n          var tokenTypeIndex = srcData[srcOffset + 3];\n          var tokenModifierSet = srcData[srcOffset + 4];\n          var metadata = styling.getMetadata(tokenTypeIndex, tokenModifierSet);\n          if (metadata !== 2147483647 /* NO_STYLING */) {\n            if (areaLine === 0) {\n              areaLine = lineNumber;\n            }\n            destData[destOffset] = lineNumber - areaLine;\n            destData[destOffset + 1] = startCharacter;\n            destData[destOffset + 2] = startCharacter + length_1;\n            destData[destOffset + 3] = metadata;\n            destOffset += 4;\n          }\n          lastLineNumber = lineNumber;\n          lastStartCharacter = startCharacter;\n          tokenIndex++;\n        }\n        if (destOffset !== destData.length) {\n          destData = destData.subarray(0, destOffset);\n        }\n        var tokens_1 = new MultilineTokens2(areaLine, new SparseEncodedTokens(destData));\n        result.push(tokens_1);\n      }\n      // Adjust incoming semantic tokens\n      if (pendingChanges.length > 0) {\n        // More changes occurred while the request was running\n        // We need to:\n        // 1. Adjust incoming semantic tokens\n        // 2. Request them again\n        for (var _b = 0, pendingChanges_1 = pendingChanges; _b < pendingChanges_1.length; _b++) {\n          var change = pendingChanges_1[_b];\n          for (var _c = 0, result_1 = result; _c < result_1.length; _c++) {\n            var area = result_1[_c];\n            for (var _d = 0, _e = change.changes; _d < _e.length; _d++) {\n              var singleChange = _e[_d];\n              area.applyEdit(singleChange.range, singleChange.text);\n            }\n          }\n        }\n        if (!this._fetchSemanticTokens.isScheduled()) {\n          this._fetchSemanticTokens.schedule();\n        }\n      }\n      this._model.setSemanticTokens(result);\n      return;\n    }\n    this._model.setSemanticTokens(null);\n  };\n  ModelSemanticColoring.prototype._getSemanticColoringProvider = function () {\n    var result = DocumentSemanticTokensProviderRegistry.ordered(this._model);\n    return result.length > 0 ? result[0] : null;\n  };\n  return ModelSemanticColoring;\n}(Disposable);","map":{"version":3,"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","Emitter","Disposable","DisposableStore","platform","errors","EDITOR_MODEL_DEFAULTS","TextModel","DocumentSemanticTokensProviderRegistry","TokenMetadata","PLAINTEXT_LANGUAGE_IDENTIFIER","ITextResourcePropertiesService","IConfigurationService","RunOnceScheduler","CancellationTokenSource","SparseEncodedTokens","MultilineTokens2","IThemeService","ILogService","LogLevel","MODEL_ID","resource","toString","ModelData","model","onWillDispose","onDidChangeLanguage","_modelEventListeners","_languageSelection","_languageSelectionListener","add","e","_disposeLanguageSelection","dispose","setLanguage","languageSelection","_this","onDidChange","setMode","languageIdentifier","DEFAULT_EOL","isLinux","isMacintosh","ModelServiceImpl","_super","configurationService","resourcePropertiesService","themeService","logService","call","_onModelAdded","_register","onModelAdded","event","_onModelRemoved","onModelRemoved","_onModelModeChanged","onModelModeChanged","_configurationService","_resourcePropertiesService","_models","_modelCreationOptionsByLanguageAndResource","_configurationServiceSubscription","onDidChangeConfiguration","_updateModelOptions","SemanticColoringFeature","_readModelOptions","config","isForSimpleWidget","tabSize","editor","parsedTabSize","parseInt","isNaN","indentSize","parsedIndentSize","insertSpaces","Boolean","newDefaultEOL","eol","trimAutoWhitespace","detectIndentation","largeFileOptimizations","defaultEOL","getCreationOptions","language","creationOptions","getValue","overrideIdentifier","getEOL","oldOptionsByLanguageAndResource","keys","len","modelId","modelData","getLanguageIdentifier","uri","oldOptions","newOptions","_setModelOptionsForModel","currentOptions","getLineCount","setEOL","updateOptions","_createModelData","value","options","Error","_onWillDispose","_onDidChangeLanguage","createModel","fire","getModels","ret","push","getModel","oldModeId","oldLanguage","newModeId","modelService","_watchers","_semanticStyling","SemanticStyling","isSemanticColoringEnabled","SETTING_ID","enabled","register","ModelSemanticColoring","deregister","modelSemanticColoring","curr","affectsConfiguration","_i","_a","_themeService","_logService","_caches","WeakMap","onThemeChange","get","provider","has","set","SemanticColoringProviderStyling","getLegend","HashTableEntry","tokenTypeIndex","tokenModifierSet","metadata","next","HashTable","_elementsCount","_currentLengthIndex","_currentLength","_SIZES","_growCount","Math","round","_elements","_nullOutEntries","entries","_hashFunc","hash","oldElements","oldElements_1","first","oldNext","_add","element","_legend","_hashTable","getMetadata","entry","tokenType","tokenTypes","tokenModifiers","modifierSet","modifierIndex","tokenStyle","getTheme","getTokenStyleMetadata","italic","italicBit","bold","boldBit","underline","underlineBit","foreground","foregroundBits","getLevel","Trace","type","modifiers","filter","_","join","trace","getForeground","getFontStyle","SemanticTokensResponse","_provider","resultId","data","releaseDocumentSemanticTokens","stylingProvider","_isDisposed","_model","_fetchSemanticTokens","_fetchSemanticTokensNow","_currentResponse","_currentRequestCancellationTokenSource","onDidChangeContent","isScheduled","schedule","_setSemanticTokens","cancel","_getSemanticColoringProvider","pendingChanges","contentChangeListener","styling","lastResultId","request","Promise","resolve","provideDocumentSemanticTokens","token","then","res","err","message","indexOf","onUnexpectedError","_isSemanticTokens","v","_isSemanticTokensEdits","isArray","edits","_copy","src","srcOffset","dest","destOffset","tokens","currentResponse","setSemanticTokens","deltaLength","edit","deleteCount","srcData","destData","Uint32Array","srcLastStart","destLastStart","copyCount","start","tokenCount","tokensPerArea","max","ceil","result","tokenIndex","lastLineNumber","lastStartCharacter","tokenStartIndex","tokenEndIndex","min","smallTokenEndIndex","bigTokenEndIndex","areaLine","deltaLine","deltaCharacter","lineNumber","startCharacter","length_1","subarray","tokens_1","_b","pendingChanges_1","change","_c","result_1","area","_d","_e","changes","singleChange","applyEdit","range","text","ordered"],"sources":["C:/Users/akash/Desktop/agat project/CLientapp/node_modules/monaco-editor/esm/vs/editor/common/services/modelServiceImpl.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport * as errors from '../../../base/common/errors.js';\r\nimport { EDITOR_MODEL_DEFAULTS } from '../config/editorOptions.js';\r\nimport { TextModel } from '../model/textModel.js';\r\nimport { DocumentSemanticTokensProviderRegistry, TokenMetadata } from '../modes.js';\r\nimport { PLAINTEXT_LANGUAGE_IDENTIFIER } from '../modes/modesRegistry.js';\r\nimport { ITextResourcePropertiesService } from './textResourceConfigurationService.js';\r\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\r\nimport { RunOnceScheduler } from '../../../base/common/async.js';\r\nimport { CancellationTokenSource } from '../../../base/common/cancellation.js';\r\nimport { SparseEncodedTokens, MultilineTokens2 } from '../model/tokensStore.js';\r\nimport { IThemeService } from '../../../platform/theme/common/themeService.js';\r\nimport { ILogService, LogLevel } from '../../../platform/log/common/log.js';\r\nfunction MODEL_ID(resource) {\r\n    return resource.toString();\r\n}\r\nvar ModelData = /** @class */ (function () {\r\n    function ModelData(model, onWillDispose, onDidChangeLanguage) {\r\n        this._modelEventListeners = new DisposableStore();\r\n        this.model = model;\r\n        this._languageSelection = null;\r\n        this._languageSelectionListener = null;\r\n        this._modelEventListeners.add(model.onWillDispose(function () { return onWillDispose(model); }));\r\n        this._modelEventListeners.add(model.onDidChangeLanguage(function (e) { return onDidChangeLanguage(model, e); }));\r\n    }\r\n    ModelData.prototype._disposeLanguageSelection = function () {\r\n        if (this._languageSelectionListener) {\r\n            this._languageSelectionListener.dispose();\r\n            this._languageSelectionListener = null;\r\n        }\r\n        if (this._languageSelection) {\r\n            this._languageSelection.dispose();\r\n            this._languageSelection = null;\r\n        }\r\n    };\r\n    ModelData.prototype.dispose = function () {\r\n        this._modelEventListeners.dispose();\r\n        this._disposeLanguageSelection();\r\n    };\r\n    ModelData.prototype.setLanguage = function (languageSelection) {\r\n        var _this = this;\r\n        this._disposeLanguageSelection();\r\n        this._languageSelection = languageSelection;\r\n        this._languageSelectionListener = this._languageSelection.onDidChange(function () { return _this.model.setMode(languageSelection.languageIdentifier); });\r\n        this.model.setMode(languageSelection.languageIdentifier);\r\n    };\r\n    return ModelData;\r\n}());\r\nvar DEFAULT_EOL = (platform.isLinux || platform.isMacintosh) ? 1 /* LF */ : 2 /* CRLF */;\r\nvar ModelServiceImpl = /** @class */ (function (_super) {\r\n    __extends(ModelServiceImpl, _super);\r\n    function ModelServiceImpl(configurationService, resourcePropertiesService, themeService, logService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._onModelAdded = _this._register(new Emitter());\r\n        _this.onModelAdded = _this._onModelAdded.event;\r\n        _this._onModelRemoved = _this._register(new Emitter());\r\n        _this.onModelRemoved = _this._onModelRemoved.event;\r\n        _this._onModelModeChanged = _this._register(new Emitter());\r\n        _this.onModelModeChanged = _this._onModelModeChanged.event;\r\n        _this._configurationService = configurationService;\r\n        _this._resourcePropertiesService = resourcePropertiesService;\r\n        _this._models = {};\r\n        _this._modelCreationOptionsByLanguageAndResource = Object.create(null);\r\n        _this._configurationServiceSubscription = _this._configurationService.onDidChangeConfiguration(function (e) { return _this._updateModelOptions(); });\r\n        _this._updateModelOptions();\r\n        _this._register(new SemanticColoringFeature(_this, themeService, configurationService, logService));\r\n        return _this;\r\n    }\r\n    ModelServiceImpl._readModelOptions = function (config, isForSimpleWidget) {\r\n        var tabSize = EDITOR_MODEL_DEFAULTS.tabSize;\r\n        if (config.editor && typeof config.editor.tabSize !== 'undefined') {\r\n            var parsedTabSize = parseInt(config.editor.tabSize, 10);\r\n            if (!isNaN(parsedTabSize)) {\r\n                tabSize = parsedTabSize;\r\n            }\r\n            if (tabSize < 1) {\r\n                tabSize = 1;\r\n            }\r\n        }\r\n        var indentSize = tabSize;\r\n        if (config.editor && typeof config.editor.indentSize !== 'undefined' && config.editor.indentSize !== 'tabSize') {\r\n            var parsedIndentSize = parseInt(config.editor.indentSize, 10);\r\n            if (!isNaN(parsedIndentSize)) {\r\n                indentSize = parsedIndentSize;\r\n            }\r\n            if (indentSize < 1) {\r\n                indentSize = 1;\r\n            }\r\n        }\r\n        var insertSpaces = EDITOR_MODEL_DEFAULTS.insertSpaces;\r\n        if (config.editor && typeof config.editor.insertSpaces !== 'undefined') {\r\n            insertSpaces = (config.editor.insertSpaces === 'false' ? false : Boolean(config.editor.insertSpaces));\r\n        }\r\n        var newDefaultEOL = DEFAULT_EOL;\r\n        var eol = config.eol;\r\n        if (eol === '\\r\\n') {\r\n            newDefaultEOL = 2 /* CRLF */;\r\n        }\r\n        else if (eol === '\\n') {\r\n            newDefaultEOL = 1 /* LF */;\r\n        }\r\n        var trimAutoWhitespace = EDITOR_MODEL_DEFAULTS.trimAutoWhitespace;\r\n        if (config.editor && typeof config.editor.trimAutoWhitespace !== 'undefined') {\r\n            trimAutoWhitespace = (config.editor.trimAutoWhitespace === 'false' ? false : Boolean(config.editor.trimAutoWhitespace));\r\n        }\r\n        var detectIndentation = EDITOR_MODEL_DEFAULTS.detectIndentation;\r\n        if (config.editor && typeof config.editor.detectIndentation !== 'undefined') {\r\n            detectIndentation = (config.editor.detectIndentation === 'false' ? false : Boolean(config.editor.detectIndentation));\r\n        }\r\n        var largeFileOptimizations = EDITOR_MODEL_DEFAULTS.largeFileOptimizations;\r\n        if (config.editor && typeof config.editor.largeFileOptimizations !== 'undefined') {\r\n            largeFileOptimizations = (config.editor.largeFileOptimizations === 'false' ? false : Boolean(config.editor.largeFileOptimizations));\r\n        }\r\n        return {\r\n            isForSimpleWidget: isForSimpleWidget,\r\n            tabSize: tabSize,\r\n            indentSize: indentSize,\r\n            insertSpaces: insertSpaces,\r\n            detectIndentation: detectIndentation,\r\n            defaultEOL: newDefaultEOL,\r\n            trimAutoWhitespace: trimAutoWhitespace,\r\n            largeFileOptimizations: largeFileOptimizations\r\n        };\r\n    };\r\n    ModelServiceImpl.prototype.getCreationOptions = function (language, resource, isForSimpleWidget) {\r\n        var creationOptions = this._modelCreationOptionsByLanguageAndResource[language + resource];\r\n        if (!creationOptions) {\r\n            var editor = this._configurationService.getValue('editor', { overrideIdentifier: language, resource: resource });\r\n            var eol = this._resourcePropertiesService.getEOL(resource, language);\r\n            creationOptions = ModelServiceImpl._readModelOptions({ editor: editor, eol: eol }, isForSimpleWidget);\r\n            this._modelCreationOptionsByLanguageAndResource[language + resource] = creationOptions;\r\n        }\r\n        return creationOptions;\r\n    };\r\n    ModelServiceImpl.prototype._updateModelOptions = function () {\r\n        var oldOptionsByLanguageAndResource = this._modelCreationOptionsByLanguageAndResource;\r\n        this._modelCreationOptionsByLanguageAndResource = Object.create(null);\r\n        // Update options on all models\r\n        var keys = Object.keys(this._models);\r\n        for (var i = 0, len = keys.length; i < len; i++) {\r\n            var modelId = keys[i];\r\n            var modelData = this._models[modelId];\r\n            var language = modelData.model.getLanguageIdentifier().language;\r\n            var uri = modelData.model.uri;\r\n            var oldOptions = oldOptionsByLanguageAndResource[language + uri];\r\n            var newOptions = this.getCreationOptions(language, uri, modelData.model.isForSimpleWidget);\r\n            ModelServiceImpl._setModelOptionsForModel(modelData.model, newOptions, oldOptions);\r\n        }\r\n    };\r\n    ModelServiceImpl._setModelOptionsForModel = function (model, newOptions, currentOptions) {\r\n        if (currentOptions && currentOptions.defaultEOL !== newOptions.defaultEOL && model.getLineCount() === 1) {\r\n            model.setEOL(newOptions.defaultEOL === 1 /* LF */ ? 0 /* LF */ : 1 /* CRLF */);\r\n        }\r\n        if (currentOptions\r\n            && (currentOptions.detectIndentation === newOptions.detectIndentation)\r\n            && (currentOptions.insertSpaces === newOptions.insertSpaces)\r\n            && (currentOptions.tabSize === newOptions.tabSize)\r\n            && (currentOptions.indentSize === newOptions.indentSize)\r\n            && (currentOptions.trimAutoWhitespace === newOptions.trimAutoWhitespace)) {\r\n            // Same indent opts, no need to touch the model\r\n            return;\r\n        }\r\n        if (newOptions.detectIndentation) {\r\n            model.detectIndentation(newOptions.insertSpaces, newOptions.tabSize);\r\n            model.updateOptions({\r\n                trimAutoWhitespace: newOptions.trimAutoWhitespace\r\n            });\r\n        }\r\n        else {\r\n            model.updateOptions({\r\n                insertSpaces: newOptions.insertSpaces,\r\n                tabSize: newOptions.tabSize,\r\n                indentSize: newOptions.indentSize,\r\n                trimAutoWhitespace: newOptions.trimAutoWhitespace\r\n            });\r\n        }\r\n    };\r\n    ModelServiceImpl.prototype.dispose = function () {\r\n        this._configurationServiceSubscription.dispose();\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    // --- begin IModelService\r\n    ModelServiceImpl.prototype._createModelData = function (value, languageIdentifier, resource, isForSimpleWidget) {\r\n        var _this = this;\r\n        // create & save the model\r\n        var options = this.getCreationOptions(languageIdentifier.language, resource, isForSimpleWidget);\r\n        var model = new TextModel(value, options, languageIdentifier, resource);\r\n        var modelId = MODEL_ID(model.uri);\r\n        if (this._models[modelId]) {\r\n            // There already exists a model with this id => this is a programmer error\r\n            throw new Error('ModelService: Cannot add model because it already exists!');\r\n        }\r\n        var modelData = new ModelData(model, function (model) { return _this._onWillDispose(model); }, function (model, e) { return _this._onDidChangeLanguage(model, e); });\r\n        this._models[modelId] = modelData;\r\n        return modelData;\r\n    };\r\n    ModelServiceImpl.prototype.createModel = function (value, languageSelection, resource, isForSimpleWidget) {\r\n        if (isForSimpleWidget === void 0) { isForSimpleWidget = false; }\r\n        var modelData;\r\n        if (languageSelection) {\r\n            modelData = this._createModelData(value, languageSelection.languageIdentifier, resource, isForSimpleWidget);\r\n            this.setMode(modelData.model, languageSelection);\r\n        }\r\n        else {\r\n            modelData = this._createModelData(value, PLAINTEXT_LANGUAGE_IDENTIFIER, resource, isForSimpleWidget);\r\n        }\r\n        this._onModelAdded.fire(modelData.model);\r\n        return modelData.model;\r\n    };\r\n    ModelServiceImpl.prototype.setMode = function (model, languageSelection) {\r\n        if (!languageSelection) {\r\n            return;\r\n        }\r\n        var modelData = this._models[MODEL_ID(model.uri)];\r\n        if (!modelData) {\r\n            return;\r\n        }\r\n        modelData.setLanguage(languageSelection);\r\n    };\r\n    ModelServiceImpl.prototype.getModels = function () {\r\n        var ret = [];\r\n        var keys = Object.keys(this._models);\r\n        for (var i = 0, len = keys.length; i < len; i++) {\r\n            var modelId = keys[i];\r\n            ret.push(this._models[modelId].model);\r\n        }\r\n        return ret;\r\n    };\r\n    ModelServiceImpl.prototype.getModel = function (resource) {\r\n        var modelId = MODEL_ID(resource);\r\n        var modelData = this._models[modelId];\r\n        if (!modelData) {\r\n            return null;\r\n        }\r\n        return modelData.model;\r\n    };\r\n    // --- end IModelService\r\n    ModelServiceImpl.prototype._onWillDispose = function (model) {\r\n        var modelId = MODEL_ID(model.uri);\r\n        var modelData = this._models[modelId];\r\n        delete this._models[modelId];\r\n        modelData.dispose();\r\n        // clean up cache\r\n        delete this._modelCreationOptionsByLanguageAndResource[model.getLanguageIdentifier().language + model.uri];\r\n        this._onModelRemoved.fire(model);\r\n    };\r\n    ModelServiceImpl.prototype._onDidChangeLanguage = function (model, e) {\r\n        var oldModeId = e.oldLanguage;\r\n        var newModeId = model.getLanguageIdentifier().language;\r\n        var oldOptions = this.getCreationOptions(oldModeId, model.uri, model.isForSimpleWidget);\r\n        var newOptions = this.getCreationOptions(newModeId, model.uri, model.isForSimpleWidget);\r\n        ModelServiceImpl._setModelOptionsForModel(model, newOptions, oldOptions);\r\n        this._onModelModeChanged.fire({ model: model, oldModeId: oldModeId });\r\n    };\r\n    ModelServiceImpl = __decorate([\r\n        __param(0, IConfigurationService),\r\n        __param(1, ITextResourcePropertiesService),\r\n        __param(2, IThemeService),\r\n        __param(3, ILogService)\r\n    ], ModelServiceImpl);\r\n    return ModelServiceImpl;\r\n}(Disposable));\r\nexport { ModelServiceImpl };\r\nvar SemanticColoringFeature = /** @class */ (function (_super) {\r\n    __extends(SemanticColoringFeature, _super);\r\n    function SemanticColoringFeature(modelService, themeService, configurationService, logService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._configurationService = configurationService;\r\n        _this._watchers = Object.create(null);\r\n        _this._semanticStyling = _this._register(new SemanticStyling(themeService, logService));\r\n        var isSemanticColoringEnabled = function (model) {\r\n            var options = configurationService.getValue(SemanticColoringFeature.SETTING_ID, { overrideIdentifier: model.getLanguageIdentifier().language, resource: model.uri });\r\n            return options && options.enabled;\r\n        };\r\n        var register = function (model) {\r\n            _this._watchers[model.uri.toString()] = new ModelSemanticColoring(model, themeService, _this._semanticStyling);\r\n        };\r\n        var deregister = function (model, modelSemanticColoring) {\r\n            modelSemanticColoring.dispose();\r\n            delete _this._watchers[model.uri.toString()];\r\n        };\r\n        _this._register(modelService.onModelAdded(function (model) {\r\n            if (isSemanticColoringEnabled(model)) {\r\n                register(model);\r\n            }\r\n        }));\r\n        _this._register(modelService.onModelRemoved(function (model) {\r\n            var curr = _this._watchers[model.uri.toString()];\r\n            if (curr) {\r\n                deregister(model, curr);\r\n            }\r\n        }));\r\n        _this._configurationService.onDidChangeConfiguration(function (e) {\r\n            if (e.affectsConfiguration(SemanticColoringFeature.SETTING_ID)) {\r\n                for (var _i = 0, _a = modelService.getModels(); _i < _a.length; _i++) {\r\n                    var model = _a[_i];\r\n                    var curr = _this._watchers[model.uri.toString()];\r\n                    if (isSemanticColoringEnabled(model)) {\r\n                        if (!curr) {\r\n                            register(model);\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (curr) {\r\n                            deregister(model, curr);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return _this;\r\n    }\r\n    SemanticColoringFeature.SETTING_ID = 'editor.semanticHighlighting';\r\n    return SemanticColoringFeature;\r\n}(Disposable));\r\nvar SemanticStyling = /** @class */ (function (_super) {\r\n    __extends(SemanticStyling, _super);\r\n    function SemanticStyling(_themeService, _logService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._themeService = _themeService;\r\n        _this._logService = _logService;\r\n        _this._caches = new WeakMap();\r\n        if (_this._themeService) {\r\n            // workaround for tests which use undefined... :/\r\n            _this._register(_this._themeService.onThemeChange(function () {\r\n                _this._caches = new WeakMap();\r\n            }));\r\n        }\r\n        return _this;\r\n    }\r\n    SemanticStyling.prototype.get = function (provider) {\r\n        if (!this._caches.has(provider)) {\r\n            this._caches.set(provider, new SemanticColoringProviderStyling(provider.getLegend(), this._themeService, this._logService));\r\n        }\r\n        return this._caches.get(provider);\r\n    };\r\n    return SemanticStyling;\r\n}(Disposable));\r\nvar HashTableEntry = /** @class */ (function () {\r\n    function HashTableEntry(tokenTypeIndex, tokenModifierSet, metadata) {\r\n        this.tokenTypeIndex = tokenTypeIndex;\r\n        this.tokenModifierSet = tokenModifierSet;\r\n        this.metadata = metadata;\r\n        this.next = null;\r\n    }\r\n    return HashTableEntry;\r\n}());\r\nvar HashTable = /** @class */ (function () {\r\n    function HashTable() {\r\n        this._elementsCount = 0;\r\n        this._currentLengthIndex = 0;\r\n        this._currentLength = HashTable._SIZES[this._currentLengthIndex];\r\n        this._growCount = Math.round(this._currentLengthIndex + 1 < HashTable._SIZES.length ? 2 / 3 * this._currentLength : 0);\r\n        this._elements = [];\r\n        HashTable._nullOutEntries(this._elements, this._currentLength);\r\n    }\r\n    HashTable._nullOutEntries = function (entries, length) {\r\n        for (var i = 0; i < length; i++) {\r\n            entries[i] = null;\r\n        }\r\n    };\r\n    HashTable.prototype._hashFunc = function (tokenTypeIndex, tokenModifierSet) {\r\n        return ((((tokenTypeIndex << 5) - tokenTypeIndex) + tokenModifierSet) | 0) % this._currentLength; // tokenTypeIndex * 31 + tokenModifierSet, keep as int32\r\n    };\r\n    HashTable.prototype.get = function (tokenTypeIndex, tokenModifierSet) {\r\n        var hash = this._hashFunc(tokenTypeIndex, tokenModifierSet);\r\n        var p = this._elements[hash];\r\n        while (p) {\r\n            if (p.tokenTypeIndex === tokenTypeIndex && p.tokenModifierSet === tokenModifierSet) {\r\n                return p;\r\n            }\r\n            p = p.next;\r\n        }\r\n        return null;\r\n    };\r\n    HashTable.prototype.add = function (tokenTypeIndex, tokenModifierSet, metadata) {\r\n        this._elementsCount++;\r\n        if (this._growCount !== 0 && this._elementsCount >= this._growCount) {\r\n            // expand!\r\n            var oldElements = this._elements;\r\n            this._currentLengthIndex++;\r\n            this._currentLength = HashTable._SIZES[this._currentLengthIndex];\r\n            this._growCount = Math.round(this._currentLengthIndex + 1 < HashTable._SIZES.length ? 2 / 3 * this._currentLength : 0);\r\n            this._elements = [];\r\n            HashTable._nullOutEntries(this._elements, this._currentLength);\r\n            for (var _i = 0, oldElements_1 = oldElements; _i < oldElements_1.length; _i++) {\r\n                var first = oldElements_1[_i];\r\n                var p = first;\r\n                while (p) {\r\n                    var oldNext = p.next;\r\n                    p.next = null;\r\n                    this._add(p);\r\n                    p = oldNext;\r\n                }\r\n            }\r\n        }\r\n        this._add(new HashTableEntry(tokenTypeIndex, tokenModifierSet, metadata));\r\n    };\r\n    HashTable.prototype._add = function (element) {\r\n        var hash = this._hashFunc(element.tokenTypeIndex, element.tokenModifierSet);\r\n        element.next = this._elements[hash];\r\n        this._elements[hash] = element;\r\n    };\r\n    HashTable._SIZES = [3, 7, 13, 31, 61, 127, 251, 509, 1021, 2039, 4093, 8191, 16381, 32749, 65521, 131071, 262139, 524287, 1048573, 2097143];\r\n    return HashTable;\r\n}());\r\nvar SemanticColoringProviderStyling = /** @class */ (function () {\r\n    function SemanticColoringProviderStyling(_legend, _themeService, _logService) {\r\n        this._legend = _legend;\r\n        this._themeService = _themeService;\r\n        this._logService = _logService;\r\n        this._hashTable = new HashTable();\r\n    }\r\n    SemanticColoringProviderStyling.prototype.getMetadata = function (tokenTypeIndex, tokenModifierSet) {\r\n        var entry = this._hashTable.get(tokenTypeIndex, tokenModifierSet);\r\n        var metadata;\r\n        if (entry) {\r\n            metadata = entry.metadata;\r\n        }\r\n        else {\r\n            var tokenType = this._legend.tokenTypes[tokenTypeIndex];\r\n            var tokenModifiers = [];\r\n            var modifierSet = tokenModifierSet;\r\n            for (var modifierIndex = 0; modifierSet > 0 && modifierIndex < this._legend.tokenModifiers.length; modifierIndex++) {\r\n                if (modifierSet & 1) {\r\n                    tokenModifiers.push(this._legend.tokenModifiers[modifierIndex]);\r\n                }\r\n                modifierSet = modifierSet >> 1;\r\n            }\r\n            var tokenStyle = this._themeService.getTheme().getTokenStyleMetadata(tokenType, tokenModifiers);\r\n            if (typeof tokenStyle === 'undefined') {\r\n                metadata = 2147483647 /* NO_STYLING */;\r\n            }\r\n            else {\r\n                metadata = 0;\r\n                if (typeof tokenStyle.italic !== 'undefined') {\r\n                    var italicBit = (tokenStyle.italic ? 1 /* Italic */ : 0) << 11 /* FONT_STYLE_OFFSET */;\r\n                    metadata |= italicBit | 1 /* SEMANTIC_USE_ITALIC */;\r\n                }\r\n                if (typeof tokenStyle.bold !== 'undefined') {\r\n                    var boldBit = (tokenStyle.bold ? 2 /* Bold */ : 0) << 11 /* FONT_STYLE_OFFSET */;\r\n                    metadata |= boldBit | 2 /* SEMANTIC_USE_BOLD */;\r\n                }\r\n                if (typeof tokenStyle.underline !== 'undefined') {\r\n                    var underlineBit = (tokenStyle.underline ? 4 /* Underline */ : 0) << 11 /* FONT_STYLE_OFFSET */;\r\n                    metadata |= underlineBit | 4 /* SEMANTIC_USE_UNDERLINE */;\r\n                }\r\n                if (tokenStyle.foreground) {\r\n                    var foregroundBits = (tokenStyle.foreground) << 14 /* FOREGROUND_OFFSET */;\r\n                    metadata |= foregroundBits | 8 /* SEMANTIC_USE_FOREGROUND */;\r\n                }\r\n                if (metadata === 0) {\r\n                    // Nothing!\r\n                    metadata = 2147483647 /* NO_STYLING */;\r\n                }\r\n            }\r\n            this._hashTable.add(tokenTypeIndex, tokenModifierSet, metadata);\r\n        }\r\n        if (this._logService.getLevel() === LogLevel.Trace) {\r\n            var type = this._legend.tokenTypes[tokenTypeIndex];\r\n            var modifiers = tokenModifierSet ? ' ' + this._legend.tokenModifiers.filter(function (_, i) { return tokenModifierSet & (1 << i); }).join(' ') : '';\r\n            this._logService.trace(\"tokenStyleMetadata \" + (entry ? '[CACHED] ' : '') + type + modifiers + \": foreground \" + TokenMetadata.getForeground(metadata) + \", fontStyle \" + TokenMetadata.getFontStyle(metadata).toString(2));\r\n        }\r\n        return metadata;\r\n    };\r\n    return SemanticColoringProviderStyling;\r\n}());\r\nvar SemanticTokensResponse = /** @class */ (function () {\r\n    function SemanticTokensResponse(_provider, resultId, data) {\r\n        this._provider = _provider;\r\n        this.resultId = resultId;\r\n        this.data = data;\r\n    }\r\n    SemanticTokensResponse.prototype.dispose = function () {\r\n        this._provider.releaseDocumentSemanticTokens(this.resultId);\r\n    };\r\n    return SemanticTokensResponse;\r\n}());\r\nvar ModelSemanticColoring = /** @class */ (function (_super) {\r\n    __extends(ModelSemanticColoring, _super);\r\n    function ModelSemanticColoring(model, themeService, stylingProvider) {\r\n        var _this = _super.call(this) || this;\r\n        _this._isDisposed = false;\r\n        _this._model = model;\r\n        _this._semanticStyling = stylingProvider;\r\n        _this._fetchSemanticTokens = _this._register(new RunOnceScheduler(function () { return _this._fetchSemanticTokensNow(); }, 300));\r\n        _this._currentResponse = null;\r\n        _this._currentRequestCancellationTokenSource = null;\r\n        _this._register(_this._model.onDidChangeContent(function (e) {\r\n            if (!_this._fetchSemanticTokens.isScheduled()) {\r\n                _this._fetchSemanticTokens.schedule();\r\n            }\r\n        }));\r\n        _this._register(DocumentSemanticTokensProviderRegistry.onDidChange(function (e) { return _this._fetchSemanticTokens.schedule(); }));\r\n        if (themeService) {\r\n            // workaround for tests which use undefined... :/\r\n            _this._register(themeService.onThemeChange(function (_) {\r\n                // clear out existing tokens\r\n                _this._setSemanticTokens(null, null, null, []);\r\n                _this._fetchSemanticTokens.schedule();\r\n            }));\r\n        }\r\n        _this._fetchSemanticTokens.schedule(0);\r\n        return _this;\r\n    }\r\n    ModelSemanticColoring.prototype.dispose = function () {\r\n        if (this._currentResponse) {\r\n            this._currentResponse.dispose();\r\n            this._currentResponse = null;\r\n        }\r\n        if (this._currentRequestCancellationTokenSource) {\r\n            this._currentRequestCancellationTokenSource.cancel();\r\n            this._currentRequestCancellationTokenSource = null;\r\n        }\r\n        this._setSemanticTokens(null, null, null, []);\r\n        this._isDisposed = true;\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    ModelSemanticColoring.prototype._fetchSemanticTokensNow = function () {\r\n        var _this = this;\r\n        if (this._currentRequestCancellationTokenSource) {\r\n            // there is already a request running, let it finish...\r\n            return;\r\n        }\r\n        var provider = this._getSemanticColoringProvider();\r\n        if (!provider) {\r\n            return;\r\n        }\r\n        this._currentRequestCancellationTokenSource = new CancellationTokenSource();\r\n        var pendingChanges = [];\r\n        var contentChangeListener = this._model.onDidChangeContent(function (e) {\r\n            pendingChanges.push(e);\r\n        });\r\n        var styling = this._semanticStyling.get(provider);\r\n        var lastResultId = this._currentResponse ? this._currentResponse.resultId || null : null;\r\n        var request = Promise.resolve(provider.provideDocumentSemanticTokens(this._model, lastResultId, this._currentRequestCancellationTokenSource.token));\r\n        request.then(function (res) {\r\n            _this._currentRequestCancellationTokenSource = null;\r\n            contentChangeListener.dispose();\r\n            _this._setSemanticTokens(provider, res || null, styling, pendingChanges);\r\n        }, function (err) {\r\n            if (!err || typeof err.message !== 'string' || err.message.indexOf('busy') === -1) {\r\n                errors.onUnexpectedError(err);\r\n            }\r\n            // Semantic tokens eats up all errors and considers errors to mean that the result is temporarily not available\r\n            // The API does not have a special error kind to express this...\r\n            _this._currentRequestCancellationTokenSource = null;\r\n            contentChangeListener.dispose();\r\n            if (pendingChanges.length > 0) {\r\n                // More changes occurred while the request was running\r\n                if (!_this._fetchSemanticTokens.isScheduled()) {\r\n                    _this._fetchSemanticTokens.schedule();\r\n                }\r\n            }\r\n        });\r\n    };\r\n    ModelSemanticColoring._isSemanticTokens = function (v) {\r\n        return v && !!(v.data);\r\n    };\r\n    ModelSemanticColoring._isSemanticTokensEdits = function (v) {\r\n        return v && Array.isArray(v.edits);\r\n    };\r\n    ModelSemanticColoring._copy = function (src, srcOffset, dest, destOffset, length) {\r\n        for (var i = 0; i < length; i++) {\r\n            dest[destOffset + i] = src[srcOffset + i];\r\n        }\r\n    };\r\n    ModelSemanticColoring.prototype._setSemanticTokens = function (provider, tokens, styling, pendingChanges) {\r\n        var currentResponse = this._currentResponse;\r\n        if (this._currentResponse) {\r\n            this._currentResponse.dispose();\r\n            this._currentResponse = null;\r\n        }\r\n        if (this._isDisposed) {\r\n            // disposed!\r\n            if (provider && tokens) {\r\n                provider.releaseDocumentSemanticTokens(tokens.resultId);\r\n            }\r\n            return;\r\n        }\r\n        if (!provider || !tokens || !styling) {\r\n            this._model.setSemanticTokens(null);\r\n            return;\r\n        }\r\n        if (ModelSemanticColoring._isSemanticTokensEdits(tokens)) {\r\n            if (!currentResponse) {\r\n                // not possible!\r\n                this._model.setSemanticTokens(null);\r\n                return;\r\n            }\r\n            if (tokens.edits.length === 0) {\r\n                // nothing to do!\r\n                tokens = {\r\n                    resultId: tokens.resultId,\r\n                    data: currentResponse.data\r\n                };\r\n            }\r\n            else {\r\n                var deltaLength = 0;\r\n                for (var _i = 0, _a = tokens.edits; _i < _a.length; _i++) {\r\n                    var edit = _a[_i];\r\n                    deltaLength += (edit.data ? edit.data.length : 0) - edit.deleteCount;\r\n                }\r\n                var srcData = currentResponse.data;\r\n                var destData = new Uint32Array(srcData.length + deltaLength);\r\n                var srcLastStart = srcData.length;\r\n                var destLastStart = destData.length;\r\n                for (var i = tokens.edits.length - 1; i >= 0; i--) {\r\n                    var edit = tokens.edits[i];\r\n                    var copyCount = srcLastStart - (edit.start + edit.deleteCount);\r\n                    if (copyCount > 0) {\r\n                        ModelSemanticColoring._copy(srcData, srcLastStart - copyCount, destData, destLastStart - copyCount, copyCount);\r\n                        destLastStart -= copyCount;\r\n                    }\r\n                    if (edit.data) {\r\n                        ModelSemanticColoring._copy(edit.data, 0, destData, destLastStart - edit.data.length, edit.data.length);\r\n                        destLastStart -= edit.data.length;\r\n                    }\r\n                    srcLastStart = edit.start;\r\n                }\r\n                if (srcLastStart > 0) {\r\n                    ModelSemanticColoring._copy(srcData, 0, destData, 0, srcLastStart);\r\n                }\r\n                tokens = {\r\n                    resultId: tokens.resultId,\r\n                    data: destData\r\n                };\r\n            }\r\n        }\r\n        if (ModelSemanticColoring._isSemanticTokens(tokens)) {\r\n            this._currentResponse = new SemanticTokensResponse(provider, tokens.resultId, tokens.data);\r\n            var srcData = tokens.data;\r\n            var tokenCount = (tokens.data.length / 5) | 0;\r\n            var tokensPerArea = Math.max(Math.ceil(tokenCount / 1024 /* DesiredMaxAreas */), 400 /* DesiredTokensPerArea */);\r\n            var result = [];\r\n            var tokenIndex = 0;\r\n            var lastLineNumber = 1;\r\n            var lastStartCharacter = 0;\r\n            while (tokenIndex < tokenCount) {\r\n                var tokenStartIndex = tokenIndex;\r\n                var tokenEndIndex = Math.min(tokenStartIndex + tokensPerArea, tokenCount);\r\n                // Keep tokens on the same line in the same area...\r\n                if (tokenEndIndex < tokenCount) {\r\n                    var smallTokenEndIndex = tokenEndIndex;\r\n                    while (smallTokenEndIndex - 1 > tokenStartIndex && srcData[5 * smallTokenEndIndex] === 0) {\r\n                        smallTokenEndIndex--;\r\n                    }\r\n                    if (smallTokenEndIndex - 1 === tokenStartIndex) {\r\n                        // there are so many tokens on this line that our area would be empty, we must now go right\r\n                        var bigTokenEndIndex = tokenEndIndex;\r\n                        while (bigTokenEndIndex + 1 < tokenCount && srcData[5 * bigTokenEndIndex] === 0) {\r\n                            bigTokenEndIndex++;\r\n                        }\r\n                        tokenEndIndex = bigTokenEndIndex;\r\n                    }\r\n                    else {\r\n                        tokenEndIndex = smallTokenEndIndex;\r\n                    }\r\n                }\r\n                var destData = new Uint32Array((tokenEndIndex - tokenStartIndex) * 4);\r\n                var destOffset = 0;\r\n                var areaLine = 0;\r\n                while (tokenIndex < tokenEndIndex) {\r\n                    var srcOffset = 5 * tokenIndex;\r\n                    var deltaLine = srcData[srcOffset];\r\n                    var deltaCharacter = srcData[srcOffset + 1];\r\n                    var lineNumber = lastLineNumber + deltaLine;\r\n                    var startCharacter = (deltaLine === 0 ? lastStartCharacter + deltaCharacter : deltaCharacter);\r\n                    var length_1 = srcData[srcOffset + 2];\r\n                    var tokenTypeIndex = srcData[srcOffset + 3];\r\n                    var tokenModifierSet = srcData[srcOffset + 4];\r\n                    var metadata = styling.getMetadata(tokenTypeIndex, tokenModifierSet);\r\n                    if (metadata !== 2147483647 /* NO_STYLING */) {\r\n                        if (areaLine === 0) {\r\n                            areaLine = lineNumber;\r\n                        }\r\n                        destData[destOffset] = lineNumber - areaLine;\r\n                        destData[destOffset + 1] = startCharacter;\r\n                        destData[destOffset + 2] = startCharacter + length_1;\r\n                        destData[destOffset + 3] = metadata;\r\n                        destOffset += 4;\r\n                    }\r\n                    lastLineNumber = lineNumber;\r\n                    lastStartCharacter = startCharacter;\r\n                    tokenIndex++;\r\n                }\r\n                if (destOffset !== destData.length) {\r\n                    destData = destData.subarray(0, destOffset);\r\n                }\r\n                var tokens_1 = new MultilineTokens2(areaLine, new SparseEncodedTokens(destData));\r\n                result.push(tokens_1);\r\n            }\r\n            // Adjust incoming semantic tokens\r\n            if (pendingChanges.length > 0) {\r\n                // More changes occurred while the request was running\r\n                // We need to:\r\n                // 1. Adjust incoming semantic tokens\r\n                // 2. Request them again\r\n                for (var _b = 0, pendingChanges_1 = pendingChanges; _b < pendingChanges_1.length; _b++) {\r\n                    var change = pendingChanges_1[_b];\r\n                    for (var _c = 0, result_1 = result; _c < result_1.length; _c++) {\r\n                        var area = result_1[_c];\r\n                        for (var _d = 0, _e = change.changes; _d < _e.length; _d++) {\r\n                            var singleChange = _e[_d];\r\n                            area.applyEdit(singleChange.range, singleChange.text);\r\n                        }\r\n                    }\r\n                }\r\n                if (!this._fetchSemanticTokens.isScheduled()) {\r\n                    this._fetchSemanticTokens.schedule();\r\n                }\r\n            }\r\n            this._model.setSemanticTokens(result);\r\n            return;\r\n        }\r\n        this._model.setSemanticTokens(null);\r\n    };\r\n    ModelSemanticColoring.prototype._getSemanticColoringProvider = function () {\r\n        var result = DocumentSemanticTokensProviderRegistry.ordered(this._model);\r\n        return (result.length > 0 ? result[0] : null);\r\n    };\r\n    return ModelSemanticColoring;\r\n}(Disposable));\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}